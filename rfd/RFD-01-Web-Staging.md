# Web Deployment
## Author: Cole Styron
## Status: draft

## Purpose

Creation of a new website staging environment after the probable retirement of the `gravitational/web` repository.

## Antecedents

The current iteration of "staging" is a kubernetes-based environment.

Problems with the current version include: 
- it is relatively opaque in its operation for users unfamiliar with the relevant technologies (namely kubernetes), which is most of the marketing and UX personnel
- it is difficult to troubleshoot
- it requires a manual deploy from the command line (a problem for non-technical users)
- it is singular; a deploy to staging replaces the previous state, so users must queue and communicate synchronously
- it is presently not functional for users on an M1 Mac

## Considerations

The current state of user-facing side of `goteleport.com` is as follows: 
- routing is handled by nginx and its files are hosted on `gravitational/web`
- roughly 1000 pages of docs are hosted at `gravitational/teleport` and imported as submodules into `gravitational/next`
- roughly 100 pages of user-facing marketing pages are hosted on `gravitational/next`
- roughly 200 pages of blog articles are hosted on `gravitational/next`
- a few remaining pages are hosted on `gravitational/web` but should be ported to `gravitational/next` by the end of February 2022.


The intention at present is for `gravitational/web` to be deprecated entirely and for the routing functionality currently in `gravitational/web/deploy/nginx.*` to be ported to Vercel and/or `gravitational/next`.

However discussions are now underway concerning the **possible** separation of the three main parts of `goteleport.com`: the main website (hereafter the "marketing site"), the blog, and the docs would each live in separate repos and potentially leverage separate site generation technologies, e.g. Next, Gatsby, or combination with headless CMS.

For SEO purposes, subdomains, e.g. `docs.goteleport.com` are probably not going to be used.

## Desired Functionality of the new Staging Environment

1. at least one static domain connected to the staging environment to be registered with Semrush (our SEO monitoring service) to monitor SEO impact before push to production
2. ability to push to staging automatically on merge with a possible `staging` or `seo` branch (probably to the static url above), triggering a new build of all three repos, not just the local one
3. ability to preview builds in the local repo without rebuilding the other two
4. ability for multiple users to use staging simultaneously for distinct builds

## Security 
Unknown at present

## UX

It is becoming increasingly common for non-technical marketing personnel to make changes to the user-facing website in the form of updates to marketing copy or adding/removing events using GitHub's web GUI (and potentially GitHub Desktop). Currently "preview" deploys are auto-generated by Vercel, but they are only built for pages in the local repository.

A system whereby non-techincal users could trigger a deploy to staging from GitHub's web GUI (if not Desktop) would be ideal.


## Potential Solutions

Vercel _probably_ provides an out-of-the-box solution for 1, 3, and 4, but the purpose of this RFD is to explore that and other options. 

